import { describe, expect, it } from "vitest";
import { decodeArmored } from "../src/lib/ssl";

const exampleCert = `-----BEGIN CERTIFICATE-----
MIIB7DCCAXKgAwIBAgIUcc87JKhWN9qTh7my4cdN3ftwHnIwCgYIKoZIzj0EAwIw
FjEUMBIGA1UEAwwLZXhhbXBsZS5jb20wHhcNMjQxMDEzMDI0NjU2WhcNMzQxMDEx
MDI0NjU2WjAWMRQwEgYDVQQDDAtleGFtcGxlLmNvbTB2MBAGByqGSM49AgEGBSuB
BAAiA2IABJXC8WC3vXZy/wh5+Qm2v6/SKuxcQiTdND9c3xS86cqc5iEutC/WFq2B
P2plYE7nIqRf0BmxkGQhXsP5FZ7K3dUtRw6jdlY/mK/eNJ02UbX2mU/ALHqxTXGP
dtrny315AaOBgDB+MB0GA1UdDgQWBBQN9CIFQkgt9Yar2xJvV17mMnwo2zAfBgNV
HSMEGDAWgBQN9CIFQkgt9Yar2xJvV17mMnwo2zAPBgNVHRMBAf8EBTADAQH/MCsG
A1UdEQQkMCKCC2V4YW1wbGUuY29tgg0qLmV4YW1wbGUuY29thwQKAAABMAoGCCqG
SM49BAMCA2gAMGUCMHyLjrhj3o2E3KA/lGI8nBUmO3t9JcpnO63uliFmlBCWM4Fa
/rPteYWcDuQin5ZDMQIxAPGmiq+vFg9SFZ9+rZK7MjtADAQffRaOwgDrBIwy6sV3
qOmNnBlBKX9kcdfJa1yW9Q==
-----END CERTIFICATE-----
`;

const exampleKey = `-----BEGIN PRIVATE KEY-----
MIG2AgEAMBAGByqGSM49AgEGBSuBBAAiBIGeMIGbAgEBBDDjL1WO3f73zmDS7iKQ
++FXUDBmAroLflOgKl5FQ8RkAwYEw+de27Ge83sWdAkkJ6ihZANiAASVwvFgt712
cv8IefkJtr+v0irsXEIk3TQ/XN8UvOnKnOYhLrQv1hatgT9qZWBO5yKkX9AZsZBk
IV7D+RWeyt3VLUcOo3ZWP5iv3jSdNlG19plPwCx6sU1xj3ba58t9eQE=
-----END PRIVATE KEY-----
`;

describe("SSL keys decoding", () => {
  it("should convert cert from pem to hexstring", () => {
    expect(decodeArmored(exampleCert)).toBe(
      "308201EC30820172A003020102021471CF3B24A85637DA9387B9B2E1C74DDDFB701E72300A06082A8648CE3D04030230163114301206035504030C0B6578616D706C652E636F6D301E170D3234313031333032343635365A170D3334313031313032343635365A30163114301206035504030C0B6578616D706C652E636F6D3076301006072A8648CE3D020106052B810400220362000495C2F160B7BD7672FF0879F909B6BFAFD22AEC5C4224DD343F5CDF14BCE9CA9CE6212EB42FD616AD813F6A65604EE722A45FD019B19064215EC3F9159ECADDD52D470EA376563F98AFDE349D3651B5F6994FC02C7AB14D718F76DAE7CB7D7901A38180307E301D0603551D0E041604140DF4220542482DF586ABDB126F575EE6327C28DB301F0603551D230418301680140DF4220542482DF586ABDB126F575EE6327C28DB300F0603551D130101FF040530030101FF302B0603551D1104243022820B6578616D706C652E636F6D820D2A2E6578616D706C652E636F6D87040A000001300A06082A8648CE3D040302036800306502307C8B8EB863DE8D84DCA03F94623C9C15263B7B7D25CA673BADEE96216694109633815AFEB3ED79859C0EE4229F964331023100F1A68AAFAF160F52159F7EAD92BB323B400C041F7D168EC200EB048C32EAC577A8E98D9C1941297F6471D7C96B5C96F5",
    );
  });
});
